# Validate Claude Code configuration files
#
# This workflow checks that required Claude Code files exist and are valid.
# Customize the checks based on your project requirements.

name: Validate Config

on:
  push:
    paths:
      - 'CLAUDE.md'
      - 'CONTEXT.md'
      - '.claude/**'
      - '.mcp.json'
  pull_request:
    paths:
      - 'CLAUDE.md'
      - 'CONTEXT.md'
      - '.claude/**'
      - '.mcp.json'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check required files exist
        run: |
          echo "Checking required Claude Code files..."

          missing=0

          for file in CLAUDE.md CONTEXT.md; do
            if [ ! -f "$file" ]; then
              echo "::error::Missing required file: $file"
              missing=1
            else
              echo "✓ $file exists"
            fi
          done

          if [ $missing -eq 1 ]; then
            exit 1
          fi

      - name: Validate JSON files
        run: |
          echo "Validating JSON configuration files..."

          for file in .claude/settings.json .mcp.json; do
            if [ -f "$file" ]; then
              if python3 -m json.tool "$file" > /dev/null 2>&1; then
                echo "✓ $file is valid JSON"
              else
                echo "::error::Invalid JSON in $file"
                exit 1
              fi
            fi
          done

      - name: Check for secrets in CLAUDE.md
        run: |
          echo "Scanning for potential secrets..."

          # Basic patterns that might indicate secrets
          patterns="password|secret|api_key|apikey|token|credential"

          if grep -iE "$patterns" CLAUDE.md CONTEXT.md 2>/dev/null | grep -v "^#"; then
            echo "::warning::Potential secrets found. Please review."
          else
            echo "✓ No obvious secrets detected"
          fi
